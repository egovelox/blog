<!doctype html>
<html lang ="en">
  <head>
    
      <meta charset='utf-8'>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <meta description="traditional post">
      <title>Postgres server conf</title>
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/modern-normalize/0.5.0/modern-normalize.min.css">
      <link rel="stylesheet" href="./styles/main.css">
      <link rel="stylesheet" href="./styles/toggle-switch.css">
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
    
  </head>
  <body>
    <nav>
      <div class="nav-left">
        <div class="nav-brand">
          <svg id = "brand" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 245 245">
            <defs>
              <style>
                .cls-1 {
                  font-size: 41px;
                  fill: #fff;
                  font-family: AmericanTypewriter, American Typewriter;
                }
                .cls-2 {
                  letter-spacing: -0.03em;
                }
              </style>
            </defs>
            <title>egovelox</title>
            <g id="Calque_2" data-name="Calque 2">
              <g id="Calque_1-2" data-name="Calque 1"><rect width="245" height="245"/>
                <text class="cls-1" transform="translate(57.7 130)">EGO<tspan x="0" y="49.2">VEL</tspan>
                  <tspan class="cls-2" x="83.56" y="49.2">O</tspan>
                  <tspan x="109.02" y="49.2">X</tspan>
                </text>
              </g>
            </g>
          </svg>
        </div>
        <div class="switch-btn-container">
          <label class="switch-light switch-material">
            <input id="switch-btn" type="checkbox"/>
            <img id="sun" src="data:image/png;base64,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" role="presentation" style="pointer-events: none;" width="16" height="16">
            <img id="moon" width="16" height="16" src="data:image/png;base64,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"/>
            <span>
              <span>Off</span>
              <span>On</span>
              <a></a>
            </span>
          </label>
        </div>
      </div>

      <ul id="navbar">
        <li class="nav-item">
          <a href="./index.html">&#9783; Memos</a>
        </li>
        <li class="nav-item">
          <a href="./index-nugae.html">Shenanigans</a>
        </li>
        <li class="nav-item">
          <a href="./about.html">About</a>
        </li>
      </ul>
    </nav>
    
  <article>
    <header>
      <h1>Postgres server conf</h1>
    </header>
    <div class="markdown-body">
      <p>Here is how to configure a PSQL instance on a <strong>CentOS 8</strong> server.</p>
<h2 id="install-from-repo">Install from repo</h2>
<pre><code class="hljs language-bash">yum install postgresql-server postgresql-contrib</code></pre>
<h2 id="getting-the-thing-started">Getting the thing started</h2>
<p>The first time you will try to run postgresql, <strong>you'll get an error !!</strong></p>
<pre><code class="hljs language-bash">sudo service postgresql start</code></pre>
<pre><code class="hljs language-bash"> Directory <span class="hljs-string">"/var/lib/pgsql/data"</span> is missing or empty.
 Use <span class="hljs-string">"/usr/bin/postgresql-setup --initdb"</span>
 to initialize the database cluster.</code></pre>
<p>The reason for this ? A script was run during the install, and, among other tasks, <strong>it created a directory /var/lib/pgsql owned by the user postgres</strong>.</p>
<p>It did not create a cluster though - a single instance of PSQL allows you to manage multiple databases in a so-called cluster - and that's why the /var/lib/pgsql/data folder is still empty.</p>
<p>So at first, always issue this command as sudo :</p>
<pre><code class="hljs language-bash">service postgresql initdb</code></pre>
<p>You can now switch user and get directly the psql command-line...</p>
<pre><code class="hljs language-bash">sudo su - postgres psql</code></pre>
<p>You can issue the query :</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> version();</code></pre>
<p>and this other :</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> pg_roles;</code></pre>
<p>You're in. Now be safe, just <strong>add a password for the postgres user</strong> :</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> postgres PASSWORD <span class="hljs-string">'myPassword'</span>;</code></pre>
<p>Let's quit psql (issue command \q) and now check the result of <strong>this init process</strong>. Go in /var/lib/pgsql :</p>
<pre><code class="hljs language-bash">[postgres@egovelox ~]$ ls
backups  data  initdb_postgresql.log

[postgres@egovelox ~]$ cat initdb_postgresql.log
The files belonging to this database system will be owned by user <span class="hljs-string">"postgres"</span>.
This user must also own the server process.

The database cluster will be initialized with locale <span class="hljs-string">"en_US.UTF-8"</span>.
The default database encoding has accordingly been <span class="hljs-built_in">set</span> to <span class="hljs-string">"UTF8"</span>.
The default text search configuration will be <span class="hljs-built_in">set</span> to <span class="hljs-string">"english"</span>.

Data page checksums are disabled.

fixing permissions on existing directory /var/lib/pgsql/data ... ok
creating subdirectories ... ok
selecting default max_connections ... 100
selecting default shared_buffers ... 128MB
selecting dynamic shared memory implementation ... posix
creating configuration files ... ok
running bootstrap script ... ok
performing post-bootstrap initialization ... ok
syncing data to disk ... ok

Success. You can now start the database server using:

    /usr/bin/pg_ctl -D /var/lib/pgsql/data -l logfile start
</code></pre>
<p>To start the PGSQL server, now you can either :</p>
<ol>
<li>as user postgres, run the latter (adding &#x26;)</li>
<li>or just prefer, from your normal account :</li>
</ol>
<pre><code class="hljs language-bash">sudo systemctl start postgresql &#x26;&#x26; systemctl <span class="hljs-built_in">enable</span> postgresql</code></pre>
<p>Fell free to check the "newborn" logfile in /var/lib/pgsql</p>
<pre><code class="hljs language-bash">[postgres@egovelox ~]$ ls
backups  data  initdb_postgresql.log  logfile
[postgres@egovelox ~]$ cat logfile
2020-03-27 04:07:51.750 CET [16656] LOG:  listening on IPv6 address <span class="hljs-string">"::1"</span>, port 5432
2020-03-27 04:07:51.750 CET [16656] LOG:  listening on IPv4 address <span class="hljs-string">"127.0.0.1"</span>, port 5432
2020-03-27 04:07:51.754 CET [16656] LOG:  listening on Unix socket <span class="hljs-string">"/var/run/postgresql/.s.PGSQL.5432"</span>
2020-03-27 04:07:51.762 CET [16656] LOG:  listening on Unix socket <span class="hljs-string">"/tmp/.s.PGSQL.5432"</span>
2020-03-27 04:07:51.773 CET [16656] LOG:  redirecting <span class="hljs-built_in">log</span> output to logging collector process
2020-03-27 04:07:51.773 CET [16656] HINT:  Future <span class="hljs-built_in">log</span> output will appear <span class="hljs-keyword">in</span> directory <span class="hljs-string">"log"</span>.</code></pre>
<h2 id="configure-the-server">Configure the server</h2>
<p>My version of CentOS 8 (but note that it might not always be so) provided <strong>firewalld</strong> by default. So first of all,open PSQL default port (<strong>5432</strong>) :</p>
<pre><code class="hljs language-bash">sudo firewalld-cmd --zone=public --permanent --add-port 5432/tcp 
sudo firewall-cmd --reload</code></pre>
<p>Now we need to configure how PGSQL allows local or distant connections to databases. Two files are needed here, in the <strong>PGSQL instance directory /var/lib/pgsql/data/</strong> :</p>
<ol>
<li><strong>postgresql.conf</strong></li>
<li><strong>pg_hba.conf</strong> (host-based-authentication)</li>
</ol>
<p>First in postgresql.conf, change the directive listen_addresses like this :</p>
<pre><code class="hljs language-bash">listen_addresses = <span class="hljs-string">'*'</span>                  <span class="hljs-comment"># what IP address(es) to listen on;</span>
                                        <span class="hljs-comment"># comma-separated list of addresses;</span>
                                        <span class="hljs-comment"># defaults to 'localhost'; use '*' for all</span>
                                        <span class="hljs-comment"># (change requires restart)</span></code></pre>
<p>Be aware, <strong>here PGSQL needs a restart</strong> :</p>
<pre><code class="hljs language-bash">sudo systemctl restart postgresql</code></pre>
<p>Let's now assume that our machine runs behind a router, with a static address.
Here, using 0.0.0.0/0, PGSQL instance should be able to get a dialog with any machine from the outside,</p>
<ol>
<li>on all databases,</li>
<li>as long as the user is postgres</li>
<li>and password is valid (we use md5 to encrypt it along the wire).</li>
</ol>
<pre><code class="hljs language-bash"><span class="hljs-comment"># TYPE  DATABASE        USER            ADDRESS                 METHOD</span>

<span class="hljs-comment"># "local" is for Unix domain socket connections only</span>
<span class="hljs-built_in">local</span>   all             all                                     peer
<span class="hljs-comment"># IPv4 local connections:</span>
host    all             all             127.0.0.1/32            ident
host    all             postgres        0.0.0.0/0               md5
<span class="hljs-comment"># IPv6 local connections:</span>
host    all             all             ::1/128                 ident
<span class="hljs-comment"># Allow replication connections from localhost, by a user with the</span>
<span class="hljs-comment"># replication privilege.</span>
<span class="hljs-built_in">local</span>   replication     all                                     peer
host    replication     all             127.0.0.1/32            md5
host    replication     all             ::1/128                 md5</code></pre>
<p>Be aware, <strong>here PGSQL needs a reload</strong> :</p>
<pre><code class="hljs language-bash">sudo systemctl reload postgresql</code></pre>
<p><strong>And its'all done</strong> (for the 'basics' of course) !</p>
<p>Choose safety, in your router map a different port to 5432. Now you'll get remote access to your databases with the following parameters :</p>
<pre><code class="hljs language-bash">user: postgres
passwd : the pass you chose
address : your public IP
port : the port you chose
database : a default one is postgres</code></pre>

    </div>
  </article>

  <script src="//cdnjs.cloudfare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
  <script>
    window
      .hljs
      .initHighlightingOnLoad();
  </script>

    <script src="./js/theme-switcher.js"></script>
  </body>
</html>
